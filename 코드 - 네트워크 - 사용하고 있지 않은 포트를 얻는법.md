# 사용하고 있지 않은 포트를 얻는법
* 2000-??-??. magicpotato.

소켓 프로그래밍을 하다보면..
DCC같은.. 동적서버 채팅/파일전송등에서 포트할당을 할때..
이미 사용중인 포트를 지정하면 오류가 납니다.

다음과 같은 방법으로 사용하고 있지 않는 포트를 얻을 수 있습니다.

```cpp
// C++Builder code
struct sockaddr_in addr;
SOCKET s;
int i;

memset(&addr, NULL, sizeof(struct sockaddr));
addr.sin_family = AF_INET;
addr.sin_addr.s_addr = INADDR_ANY;
addr.sin_port = htons(0);

s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);

i = bind(s, (sockaddr *)&addr, sizeof(addr));
if (i == 0) {
	i = sizeof(struct sockaddr);
	getsockname(s, (sockaddr *)&addr, &i);
	ShowMessage(AnsiString(ntohs(addr.sin_port)));
}
closesocket(s);
```

EOF
